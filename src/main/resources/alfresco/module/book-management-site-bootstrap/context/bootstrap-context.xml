<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <!-- Bootstrap Title and Description messages for pacthes -->
    <bean id="org.marversolutions.bestpublishing.bootstrap.patch.resourceBundle"
          class="org.alfresco.i18n.ResourceBundleBootstrapComponent">
        <property name="resourceBundles">
            <list>
                <value>alfresco.module.${project.artifactId}.messages.patch-messages</value>
            </list>
        </property>
    </bean>

    <!-- Import People account data -->
    <bean id="org.marversolutions.bestpublishing.bootstrap.patch.bestPubPeopleLoader"
          class="org.alfresco.repo.admin.patch.impl.GenericBootstrapPatch"
          parent="basePatch" >
        <property name="id"><value>org.marversolutions.bestpublishing.bootstrap.patch.bestPubPeopleLoader</value></property>
        <property name="description"><value>org.marversolutions.bestpublishing.bootstrap.patch.bestPubPeopleLoader.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>${version.schema}</value></property>
        <property name="targetSchema"><value>20000</value></property>
        <property name="importerBootstrap">
            <ref bean="spacesBootstrap" />
        </property>
        <property name="bootstrapView">
            <props>
                <prop key="path">/${system.system_container.childname}/${system.people_container.childname}</prop>
                <prop key="location">alfresco/module/${project.artifactId}/bootstrap/users/bestpub-people.xml</prop>
            </props>
        </property>
    </bean>

    <!-- Import User account data -->
    <bean id="org.marversolutions.bestpublishing.bootstrap.patch.bestPubUsersLoader"
          class="org.alfresco.repo.admin.patch.impl.GenericBootstrapPatch"
          parent="basePatch" >
        <property name="id"><value>org.marversolutions.bestpublishing.bootstrap.patch.bestPubUsersLoader</value></property>
        <property name="description"><value>org.marversolutions.bestpublishing.bootstrap.patch.bestPubUsersLoader.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>${version.schema}</value></property>
        <property name="targetSchema"><value>20000</value></property>
        <property name="importerBootstrap">
            <ref bean="userBootstrap" />
        </property>
        <property name="bootstrapView">
            <props>
                <prop key="path">/${alfresco_user_store.system_container.childname}/${alfresco_user_store.user_container.childname}</prop>
                <prop key="location">alfresco/module/${project.artifactId}/bootstrap/users/bestpub-users.xml</prop>
            </props>
        </property>
    </bean>

    <!-- Import Groups - typically LDAP mapped -->
    <bean id="org.marversolutions.bestpublishing.bootstrap.patch.bestPubGroupsLoader"
          class="org.alfresco.repo.admin.patch.impl.GenericBootstrapPatch"
          parent="basePatch" >
        <property name="id"><value>org.marversolutions.bestpublishing.bootstrap.patch.bestPubGroupsLoader</value></property>
        <property name="description"><value>org.marversolutions.bestpublishing.bootstrap.patch.bestPubGroupsLoader.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>${version.schema}</value></property>
        <property name="targetSchema"><value>20000</value></property>
        <property name="importerBootstrap">
            <ref bean="spacesBootstrap" />
        </property>
        <property name="bootstrapView">
            <props>
                <prop key="path">/${alfresco_user_store.system_container.childname}</prop>
                <prop key="location">alfresco/module/${project.artifactId}/bootstrap/groups/bestpub-groups.xml</prop>
            </props>
        </property>
    </bean>

    <!-- Import Group memberships -->
    <bean id="org.marversolutions.bestpublishing.bootstrap.patch.bestPubGroupMembershipsLoader"
          class="org.alfresco.repo.admin.patch.impl.GenericBootstrapPatch"
          parent="basePatch" >
        <property name="id"><value>org.marversolutions.bestpublishing.bootstrap.patch.bestPubGroupMembershipsLoader</value></property>
        <property name="description"><value>org.marversolutions.bestpublishing.bootstrap.patch.bestPubGroupMembershipsLoader.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>${version.schema}</value></property>
        <property name="targetSchema"><value>20000</value></property>
        <property name="dependsOn" >
            <list>
                <ref bean="org.marversolutions.bestpublishing.bootstrap.patch.bestPubGroupsLoader" />
                <ref bean="org.marversolutions.bestpublishing.bootstrap.patch.bestPubPeopleLoader" />
                <ref bean="org.marversolutions.bestpublishing.bootstrap.patch.bestPubUsersLoader" />
            </list>
        </property>
        <property name="importerBootstrap">
            <ref bean="spacesBootstrap" />
        </property>
        <property name="bootstrapView">
            <props>
                <prop key="path">/${system.system_container.childname}</prop>
                <prop key="location">alfresco/module/${project.artifactId}/bootstrap/groups/bestpub-group-memberships.xml</prop>
            </props>
        </property>
    </bean>

    <!-- Bootstrap the Data Dictionary with Best Publishing system folders for incoming content and metadata -->
    <bean id="org.marversolutions.bestpublishing.bootstrap.patch.foldersAndFilesLoader"
          class="org.alfresco.repo.admin.patch.impl.GenericBootstrapPatch"
          parent="basePatch" >
        <property name="id"><value>org.marversolutions.bestpublishing.bootstrap.patch.foldersAndFilesLoader</value></property>
        <property name="description"><value>org.marversolutions.bestpublishing.bootstrap.patch.foldersAndFilesLoader.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>${version.schema}</value></property>
        <property name="targetSchema"><value>20000</value></property>
        <property name="importerBootstrap">
            <ref bean="spacesBootstrap" />
        </property>
        <!-- Can be used to check if something already exists, if it does then the patch will not be executed -->
        <property name="checkPath">
            <value>${spaces.company_home.childname}/${spaces.dictionary.childname}/cm:BestPub</value>
        </property>
        <property name="bootstrapView">
            <props>
                <prop key="path">${spaces.company_home.childname}/${spaces.dictionary.childname}</prop>
                <prop key="location">alfresco/module/${project.artifactId}/bootstrap/data-dictionary/bestpub-system-folders.xml</prop>
            </props>
        </property>
    </bean>

    <!-- Bootstrap the Book Management site including doclib content, users, and groups -->
    <bean id="org.marversolutions.bestpublishing.bootstrap.patch.bookManagementSiteLoader"
          class="org.alfresco.repo.admin.patch.impl.SiteLoadPatch"
          parent="basePatch">
        <property name="id"><value>org.marversolutions.bestpublishing.bootstrap.patch.bookManagementSiteLoader</value></property>
        <property name="description"><value>org.marversolutions.bestpublishing.bootstrap.patch.bookManagementSiteLoader.description</value></property>
        <property name="fixesFromSchema"><value>0</value></property>
        <property name="fixesToSchema"><value>${version.schema}</value></property>
        <property name="targetSchema"><value>20000</value></property>
        <property name="dependsOn" >
            <list>
                <ref bean="org.marversolutions.bestpublishing.bootstrap.patch.bestPubGroupMembershipsLoader" />
            </list>
        </property>
        <property name="spacesBootstrap" ref="siteLoadBootstrap-Spaces"/>
        <property name="usersBootstrap" ref="siteLoadBootstrap-Users"/>
        <property name="siteService" ref="siteService"/>
        <property name="authorityService" ref="authorityService"/>
        <property name="behaviourFilter" ref="policyBehaviourFilter"/>
        <property name="siteName">
            <value>book-management</value>
        </property>
        <property name="bootstrapViews">
            <map>
                <entry key="contents">
                    <props>
                        <prop key="location">alfresco/module/${project.artifactId}/bootstrap/site/book-management/book-management-site.acp</prop>
                    </props>
                </entry>
                <!--
                <entry key="groups">
                    <props>
                        <prop key="location">alfresco/module/${project.artifactId}/bootstrap/site/book-management/Groups.txt</prop>
                    </props>
                </entry>
                -->
            </map>
        </property>
    </bean>

</beans>
